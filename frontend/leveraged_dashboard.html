<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leveraged ETF Trading Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React icons as inline SVG components
        const TrendingUp = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Settings = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m5.196-15.196L13.5 7.5m-3 3l-3.696 3.696m0-7.392L10.5 10.5m3 3l3.696 3.696M1 12h6m6 0h6"></path>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const LeveragedETFDashboard = () => {
          const [apiKey, setApiKey] = useState('');
          const [showSettings, setShowSettings] = useState(true);
          const [symbolPairs, setSymbolPairs] = useState([
            { underlying: 'NVDA', leveraged: 'NVDL', name: 'NVIDIA', multiplier: 1.5 },
            { underlying: 'PLTR', leveraged: 'PLTU', name: 'Palantir', multiplier: 2.0 }
          ]);
          
          const [prices, setPrices] = useState({});
          const [sliders, setSliders] = useState({});
          const [lastUpdate, setLastUpdate] = useState(null);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState('');

          // Fetch real-time prices from Polygon.io
          const fetchPrices = async () => {
            if (!apiKey) {
              setError('API key is required');
              return;
            }
            
            setLoading(true);
            setError('');
            
            try {
              const allSymbols = symbolPairs.flatMap(pair => [pair.underlying, pair.leveraged]);
              const priceData = {};
              
              // Fetch prices for all symbols
              for (const symbol of allSymbols) {
                const response = await fetch(
                  `https://api.polygon.io/v2/last/trade/${symbol}?apiKey=${apiKey}`
                );
                
                if (!response.ok) {
                  if (response.status === 403) {
                    throw new Error('Invalid API key or insufficient permissions');
                  }
                  throw new Error(`Failed to fetch ${symbol}: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'ERROR') {
                  throw new Error(data.error || `Error fetching ${symbol}`);
                }
                
                priceData[symbol] = data.results?.p || 0;
              }
              
              setPrices(priceData);
              
              // Initialize sliders with current prices
              const newSliders = {};
              symbolPairs.forEach(pair => {
                if (!sliders[pair.underlying]) {
                  newSliders[pair.underlying] = priceData[pair.underlying] || 0;
                }
              });
              setSliders(prev => ({ ...prev, ...newSliders }));
              
              setLastUpdate(new Date());
            } catch (err) {
              setError(err.message);
              console.error('Fetch error:', err);
            } finally {
              setLoading(false);
            }
          };

          // Auto-refresh every 5 seconds when API key is set
          useEffect(() => {
            if (apiKey && !showSettings) {
              fetchPrices();
              const interval = setInterval(fetchPrices, 5000);
              return () => clearInterval(interval);
            }
          }, [apiKey, showSettings, symbolPairs]);

          // Calculate leveraged price using multiplier
          const calculateLeveragedPrice = (pair) => {
            const underlyingCurrent = prices[pair.underlying] || 0;
            const leveragedCurrent = prices[pair.leveraged] || 0;
            const sliderValue = sliders[pair.underlying] || underlyingCurrent;
            
            if (underlyingCurrent === 0 || leveragedCurrent === 0) return 0;
            
            // Calculate percentage change in underlying
            const underlyingPercentChange = ((sliderValue - underlyingCurrent) / underlyingCurrent);
            
            // Apply multiplier to percentage change
            const leveragedPercentChange = underlyingPercentChange * pair.multiplier;
            
            // Calculate new leveraged price
            const projectedLeveragedPrice = leveragedCurrent * (1 + leveragedPercentChange);
            
            return projectedLeveragedPrice;
          };

          // Calculate percentage change
          const calculateChange = (pair) => {
            const underlyingCurrent = prices[pair.underlying] || 0;
            const sliderValue = sliders[pair.underlying] || underlyingCurrent;
            
            if (underlyingCurrent === 0) return 0;
            
            return ((sliderValue - underlyingCurrent) / underlyingCurrent) * 100;
          };

          // Calculate leveraged percentage change
          const calculateLeveragedChange = (pair) => {
            const underlyingChange = calculateChange(pair);
            return underlyingChange * pair.multiplier;
          };

          // Add new symbol pair
          const addSymbolPair = () => {
            setSymbolPairs([...symbolPairs, { underlying: '', leveraged: '', name: '', multiplier: 2.0 }]);
          };

          // Update symbol pair
          const updateSymbolPair = (index, field, value) => {
            const newPairs = [...symbolPairs];
            if (field === 'multiplier') {
              newPairs[index][field] = parseFloat(value) || 1.0;
            } else {
              newPairs[index][field] = value.toUpperCase();
            }
            setSymbolPairs(newPairs);
          };

          // Remove symbol pair
          const removeSymbolPair = (index) => {
            setSymbolPairs(symbolPairs.filter((_, i) => i !== index));
          };

          // Save settings
          const saveSettings = () => {
            if (apiKey && symbolPairs.every(p => p.underlying && p.leveraged && p.multiplier)) {
              setShowSettings(false);
              // Trigger initial fetch
              setTimeout(() => fetchPrices(), 100);
            } else {
              setError('Please fill in API key, all symbol pairs, and multipliers');
            }
          };

          if (showSettings) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-slate-800 rounded-lg shadow-2xl p-8 border border-slate-700">
                    <h1 className="text-3xl font-bold text-white mb-6 flex items-center gap-3">
                      <Settings />
                      Dashboard Setup
                    </h1>
                    
                    <div className="mb-6 p-4 bg-blue-900/30 border border-blue-700 rounded-lg text-blue-200 text-sm">
                      <strong>Note:</strong> Settings are stored in memory only. You'll need to re-enter them when you reload the page.
                    </div>

                    {/* API Key Input */}
                    <div className="mb-8">
                      <label className="block text-sm font-medium text-slate-300 mb-2">
                        Polygon.io API Key
                      </label>
                      <input
                        type="password"
                        value={apiKey}
                        onChange={(e) => setApiKey(e.target.value)}
                        placeholder="Enter your Polygon.io API key"
                        className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      <p className="mt-2 text-xs text-slate-400">
                        Get your API key from <a href="https://polygon.io" target="_blank" className="text-blue-400 hover:underline">polygon.io</a>
                      </p>
                    </div>

                    {/* Symbol Pairs */}
                    <div className="mb-8">
                      <label className="block text-sm font-medium text-slate-300 mb-3">
                        Symbol Pairs
                      </label>
                      
                      {symbolPairs.map((pair, index) => (
                        <div key={index} className="flex gap-3 mb-3">
                          <input
                            type="text"
                            value={pair.name}
                            onChange={(e) => updateSymbolPair(index, 'name', e.target.value)}
                            placeholder="Name"
                            className="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                          <input
                            type="text"
                            value={pair.underlying}
                            onChange={(e) => updateSymbolPair(index, 'underlying', e.target.value)}
                            placeholder="Underlying"
                            className="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                          <input
                            type="text"
                            value={pair.leveraged}
                            onChange={(e) => updateSymbolPair(index, 'leveraged', e.target.value)}
                            placeholder="Leveraged"
                            className="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                          <input
                            type="number"
                            value={pair.multiplier}
                            onChange={(e) => updateSymbolPair(index, 'multiplier', e.target.value)}
                            placeholder="Multiplier"
                            step="0.1"
                            min="0.1"
                            max="10"
                            className="w-24 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                          />
                          <button
                            onClick={() => removeSymbolPair(index)}
                            className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
                          >
                            Remove
                          </button>
                        </div>
                      ))}
                      
                      <button
                        onClick={addSymbolPair}
                        className="mt-3 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors"
                      >
                        + Add Symbol Pair
                      </button>
                      
                      <p className="mt-3 text-xs text-slate-400">
                        <strong>Multiplier examples:</strong> 1.5x for NVDL, 2.0x for PLTU, 3.0x for TQQQ
                      </p>
                    </div>

                    <button
                      onClick={saveSettings}
                      className="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors"
                    >
                      Start Dashboard
                    </button>
                    
                    {error && (
                      <div className="mt-4 p-3 bg-red-900/50 border border-red-600 rounded-lg text-red-200 text-sm">
                        {error}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="flex justify-between items-center mb-6">
                  <div className="flex items-center gap-3">
                    <TrendingUp />
                    <h1 className="text-3xl font-bold text-white">Leveraged ETF Calculator</h1>
                  </div>
                  
                  <div className="flex items-center gap-4">
                    {lastUpdate && (
                      <div className="text-sm text-slate-400">
                        Updated: {lastUpdate.toLocaleTimeString()}
                      </div>
                    )}
                    <button
                      onClick={fetchPrices}
                      disabled={loading}
                      className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <RefreshCw className={loading ? 'animate-spin' : ''} />
                      Refresh
                    </button>
                    <button
                      onClick={() => setShowSettings(true)}
                      className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors"
                    >
                      <Settings />
                    </button>
                  </div>
                </div>

                {error && (
                  <div className="mb-6 p-4 bg-red-900/50 border border-red-600 rounded-lg text-red-200 flex items-center gap-2">
                    <AlertCircle />
                    {error}
                  </div>
                )}

                {/* Symbol Pairs Grid */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {symbolPairs.map((pair, index) => {
                    const underlyingCurrent = prices[pair.underlying] || 0;
                    const leveragedCurrent = prices[pair.leveraged] || 0;
                    const sliderValue = sliders[pair.underlying] || underlyingCurrent;
                    const calculatedLeveraged = calculateLeveragedPrice(pair);
                    const percentChange = calculateChange(pair);
                    const leveragedPercentChange = calculateLeveragedChange(pair);
                    const leveragedChange = calculatedLeveraged - leveragedCurrent;
                    
                    // Calculate slider range (±20% of current price)
                    const sliderMin = underlyingCurrent * 0.8;
                    const sliderMax = underlyingCurrent * 1.2;

                    return (
                      <div key={index} className="bg-slate-800 rounded-lg shadow-xl p-6 border border-slate-700">
                        <div className="flex justify-between items-start mb-4">
                          <h2 className="text-2xl font-bold text-white">{pair.name}</h2>
                          <span className="px-3 py-1 bg-purple-600 text-white text-sm font-semibold rounded-full">
                            {pair.multiplier}x
                          </span>
                        </div>
                        
                        {/* Current Prices */}
                        <div className="grid grid-cols-2 gap-4 mb-6">
                          <div className="bg-slate-700 rounded-lg p-4">
                            <div className="text-xs text-slate-400 mb-1">{pair.underlying} Current</div>
                            <div className="text-2xl font-bold text-white">${underlyingCurrent.toFixed(2)}</div>
                          </div>
                          <div className="bg-slate-700 rounded-lg p-4">
                            <div className="text-xs text-slate-400 mb-1">{pair.leveraged} Current</div>
                            <div className="text-2xl font-bold text-orange-400">${leveragedCurrent.toFixed(2)}</div>
                          </div>
                        </div>

                        {/* Slider */}
                        <div className="mb-6">
                          <label className="block text-sm font-medium text-slate-300 mb-2">
                            Set {pair.underlying} Price
                          </label>
                          <input
                            type="range"
                            min={sliderMin}
                            max={sliderMax}
                            step={0.01}
                            value={sliderValue}
                            onChange={(e) => setSliders({ ...sliders, [pair.underlying]: parseFloat(e.target.value) })}
                            className="slider w-full h-3 bg-slate-600 rounded-lg appearance-none cursor-pointer"
                          />
                          <div className="flex justify-between text-xs text-slate-400 mt-1">
                            <span>${sliderMin.toFixed(2)}</span>
                            <span>${sliderMax.toFixed(2)}</span>
                          </div>
                        </div>

                        {/* Calculated Results */}
                        <div className="bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-lg p-4 border border-blue-700/50">
                          <div className="grid grid-cols-2 gap-4 mb-3">
                            <div>
                              <div className="text-xs text-slate-400 mb-1">If {pair.underlying} is</div>
                              <div className="text-xl font-bold text-blue-300">${sliderValue.toFixed(2)}</div>
                              <div className={`text-sm font-semibold ${percentChange >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                {percentChange >= 0 ? '+' : ''}{percentChange.toFixed(2)}%
                              </div>
                            </div>
                            <div>
                              <div className="text-xs text-slate-400 mb-1">Then {pair.leveraged} ≈</div>
                              <div className="text-xl font-bold text-yellow-300">${calculatedLeveraged.toFixed(2)}</div>
                              <div className={`text-sm font-semibold ${leveragedChange >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                {leveragedChange >= 0 ? '+' : ''}${leveragedChange.toFixed(2)}
                              </div>
                            </div>
                          </div>
                          
                          <div className="pt-3 border-t border-slate-600">
                            <div className="text-xs text-slate-400 mb-1">Leveraged % Change</div>
                            <div className={`text-lg font-bold ${leveragedPercentChange >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                              {leveragedPercentChange >= 0 ? '+' : ''}{leveragedPercentChange.toFixed(2)}%
                              <span className="text-xs text-slate-400 ml-2">
                                ({percentChange.toFixed(2)}% × {pair.multiplier})
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LeveragedETFDashboard />);
    </script>
</body>
</html>